"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const v=require("vue");function X(e,n=document){return typeof e=="string"?Array.from(n.querySelectorAll(e)):e instanceof Element?[e]:e instanceof NodeList?Array.from(e):e instanceof Array?e:[]}function Z(e){const n=document.createElement("div");n.className=`scrollama__debug-step ${e}`,n.style.position="fixed",n.style.left="0",n.style.width="100%",n.style.zIndex="9999",n.style.borderTop="2px solid black",n.style.borderBottom="2px solid black";const r=document.createElement("p");return r.style.position="absolute",r.style.left="0",r.style.height="1px",r.style.width="100%",r.style.borderTop="1px dashed black",n.appendChild(r),document.body.appendChild(n),n}function ee({id:e,step:n,marginTop:r}){const{index:s,height:l}=n,a=`scrollama__debug-step--${e}-${s}`;let p=document.querySelector(`.${a}`);p||(p=Z(a)),p.style.top=`${r*-1}px`,p.style.height=`${l}px`,p.querySelector("p").style.top=`${l/2}px`}function te(){const e="abcdefghijklmnopqrstuvwxyz",n=Date.now(),r=[];for(let s=0;s<6;s+=1){const l=e[Math.floor(Math.random()*e.length)];r.push(l)}return`${r.join("")}${n}`}function M(e){console.error(`scrollama error: ${e}`)}function $(e){return+e.getAttribute("data-scrollama-index")}function ne(e,n){const r=Math.ceil(e/n),s=[],l=1/r;for(let a=0;a<r+1;a+=1)s.push(a*l);return s}function L(e){if(typeof e=="string"&&e.indexOf("px")>0){const n=+e.replace("px","");return isNaN(n)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:n}}else if(typeof e=="number"||!isNaN(+e))return e>1&&err("offset value is greater than 1. Fallback to 1."),e<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,e),1)};return null}function re(e){e.forEach(n=>n.node.setAttribute("data-scrollama-index",n.index))}function oe(e){const{top:n}=e.getBoundingClientRect(),r=window.pageYOffset,s=document.body.clientTop||0;return n+r-s}let O,k,h;function R(e){const n=e?e.scrollTop:window.pageYOffset;O!==n&&(O=n,O>k?h="down":O<k&&(h="up"),k=O)}function se(e){O=0,k=0,document.addEventListener("scroll",()=>R(e))}function ie(){let e={},n=te(),r=[],s,l,a,p=0,g=!1,d=!1,m=!1,w=!1,E=[];function P(){e={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},E=[]}function x(t){t&&!g&&I(),!t&&g&&q(),g=t}function A(t,i){const o=$(t),c=r[o];i!==void 0&&(c.progress=i);const u={element:t,index:o,progress:i,direction:h};c.state==="enter"&&e.stepProgress(u)}function F(t,i=!0){const o=$(t),c=r[o],u={element:t,index:o,direction:h};c.direction=h,c.state="enter",E[o]||e.stepEnter(u),w&&(E[o]=!0)}function D(t,i=!0){const o=$(t),c=r[o];if(!c.state)return!1;const u={element:t,index:o,direction:h};d&&(h==="down"&&c.progress<1?A(t,1):h==="up"&&c.progress>0&&A(t,0)),c.direction=h,c.state="exit",e.stepExit(u)}function K([t]){const i=$(t.target),o=r[i],c=t.target.offsetHeight;c!==o.height&&(o.height=c,N(o),j(o),H(o))}function U([t]){R(l);const{isIntersecting:i,target:o}=t;i?F(o):D(o)}function G([t]){const i=$(t.target),o=r[i],{isIntersecting:c,intersectionRatio:u,target:S}=t;c&&o.state==="enter"&&A(S,u)}function N({observers:t}){Object.keys(t).map(i=>{t[i].disconnect()})}function q(){r.forEach(N)}function H(t){const i=new ResizeObserver(K);i.observe(t.node),t.observers.resize=i}function J(){r.forEach(H)}function j(t){const i=window.innerHeight,o=t.offset||s,c=o.format==="pixels"?1:i,u=o.value*c,S=t.height/2-u,_=t.height/2-(i-u),y={rootMargin:`${S}px 0px ${_}px 0px`,threshold:.5,root:a},B=new IntersectionObserver(U,y);B.observe(t.node),t.observers.step=B,m&&ee({id:n,step:t,marginTop:S})}function Q(){r.forEach(j)}function V(t){const i=window.innerHeight,o=t.offset||s,c=o.format==="pixels"?1:i,u=o.value*c,S=-u+t.height,_=u-i,T=`${S}px 0px ${_}px 0px`,z=ne(t.height,p),b={rootMargin:T,threshold:z},y=new IntersectionObserver(G,b);y.observe(t.node),t.observers.progress=y}function W(){r.forEach(V)}function I(){q(),J(),Q(),d&&W()}const f={};return f.setup=({step:t,parent:i,offset:o=.5,threshold:c=4,progress:u=!1,once:S=!1,debug:_=!1,container:T=void 0,root:z=null})=>(se(T),r=X(t,i).map((b,y)=>({index:y,direction:void 0,height:b.offsetHeight,node:b,observers:{},offset:L(b.dataset.offset),top:oe(b),progress:0,state:void 0})),r.length?(d=u,w=S,m=_,p=Math.max(1,+c),s=L(o),l=T,a=z,P(),re(r),x(!0),f):(M("no step elements"),f)),f.enable=()=>(x(!0),f),f.disable=()=>(x(!1),f),f.destroy=()=>(x(!1),P(),f),f.resize=()=>(I(),f),f.offset=t=>t==null?s.value:(s=L(t),I(),f),f.onStepEnter=t=>(typeof t=="function"?e.stepEnter=t:M("onStepEnter requires a function"),f),f.onStepExit=t=>(typeof t=="function"?e.stepExit=t:M("onStepExit requires a function"),f),f.onStepProgress=t=>(typeof t=="function"?e.stepProgress=t:M("onStepProgress requires a function"),f),f}const le=new Set(["container","stepSelector","step","onStepEnter","onStepExit","onStepProgress"]);function C(e){return e&&typeof e=="object"&&"value"in e?e.value instanceof HTMLElement?e.value:null:e instanceof HTMLElement?e:null}function ce(e,n){return n?Array.from(e.querySelectorAll(n)).filter(r=>r instanceof HTMLElement):Array.from(e.children).filter(r=>r instanceof HTMLElement)}function Y(e){let n=null;const r=v.ref(!1);let s=null,l=null;const a=()=>!n||!r.value?!1:(n.resize(),!0),p=()=>{r.value=!1,l&&(l.disconnect(),l=null),s&&(window.removeEventListener("resize",s),s=null),n&&n.destroy()},g=()=>{if(!n)return!1;const m=C(e.container);if(!m)return!1;const w=ce(m,e.stepSelector);w.length===0&&e.stepSelector;const E={step:w};for(const[P,x]of Object.entries(e))le.has(P)||(E[P]=x);return n.setup(E),e.onStepEnter&&n.onStepEnter(e.onStepEnter),e.onStepExit&&n.onStepExit(e.onStepExit),e.onStepProgress&&n.onStepProgress(e.onStepProgress),r.value=!0,!0},d=()=>n?(n.destroy(),r.value=!1,g()):!1;return v.onMounted(()=>{n=ie(),g(),s=()=>{a()},window.addEventListener("resize",s);const m=C(e.container);m&&typeof ResizeObserver<"u"&&(l=new ResizeObserver(()=>{a()}),l.observe(m))}),v.onBeforeUnmount(()=>{p(),n=null}),{resize:a,destroy:p,rebuild:d,isReady:v.readonly(r)}}const fe=(e,n)=>{const r=e.__vccOpts||e;for(const[s,l]of n)r[s]=l;return r},ae={name:"Scrollama",inheritAttrs:!1,emits:["step-progress","step-enter","step-exit"],setup(e,{emit:n,attrs:r}){var g;const s=v.ref(null),l=v.getCurrentInstance(),a=((g=l==null?void 0:l.vnode)==null?void 0:g.props)??{},p=Object.prototype.hasOwnProperty.call(a,"onStepProgress");return Y({container:s,...r,progress:p,onStepEnter:d=>n("step-enter",d),onStepExit:d=>n("step-exit",d),onStepProgress:d=>n("step-progress",d)}),{root:s}}},ue={ref:"root",class:"scrollama__steps"};function pe(e,n,r,s,l,a){return v.openBlock(),v.createElementBlock("div",ue,[v.renderSlot(e.$slots,"default")],512)}const de=fe(ae,[["render",pe]]);exports.default=de;exports.useScrollama=Y;
