"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const y=require("vue");function W(e,s=document){return typeof e=="string"?Array.from(s.querySelectorAll(e)):e instanceof Element?[e]:e instanceof NodeList?Array.from(e):e instanceof Array?e:[]}function X(e){const s=document.createElement("div");s.className=`scrollama__debug-step ${e}`,s.style.position="fixed",s.style.left="0",s.style.width="100%",s.style.zIndex="9999",s.style.borderTop="2px solid black",s.style.borderBottom="2px solid black";const r=document.createElement("p");return r.style.position="absolute",r.style.left="0",r.style.height="1px",r.style.width="100%",r.style.borderTop="1px dashed black",s.appendChild(r),document.body.appendChild(s),s}function Z({id:e,step:s,marginTop:r}){const{index:c,height:f}=s,u=`scrollama__debug-step--${e}-${c}`;let p=document.querySelector(`.${u}`);p||(p=X(u)),p.style.top=`${r*-1}px`,p.style.height=`${f}px`,p.querySelector("p").style.top=`${f/2}px`}function ee(){const e="abcdefghijklmnopqrstuvwxyz",s=Date.now(),r=[];for(let c=0;c<6;c+=1){const f=e[Math.floor(Math.random()*e.length)];r.push(f)}return`${r.join("")}${s}`}function $(e){console.error(`scrollama error: ${e}`)}function S(e){return+e.getAttribute("data-scrollama-index")}function te(e,s){const r=Math.ceil(e/s),c=[],f=1/r;for(let u=0;u<r+1;u+=1)c.push(u*f);return c}function M(e){if(typeof e=="string"&&e.indexOf("px")>0){const s=+e.replace("px","");return isNaN(s)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:s}}else if(typeof e=="number"||!isNaN(+e))return e>1&&err("offset value is greater than 1. Fallback to 1."),e<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,e),1)};return null}function se(e){e.forEach(s=>s.node.setAttribute("data-scrollama-index",s.index))}function re(e){const{top:s}=e.getBoundingClientRect(),r=window.pageYOffset,c=document.body.clientTop||0;return s+r-c}let b,O,d;function H(e){const s=e?e.scrollTop:window.pageYOffset;b!==s&&(b=s,b>O?d="down":b<O&&(d="up"),O=b)}function ne(e){b=0,O=0,document.addEventListener("scroll",()=>H(e))}function Y(){let e={},s=ee(),r=[],c,f,u,p=0,P=!1,z=!1,R=!1,A=!1,_=[];function q(){e={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},_=[]}function E(t){t&&!P&&T(),!t&&P&&j(),P=t}function k(t,o){const n=S(t),i=r[n];o!==void 0&&(i.progress=o);const a={element:t,index:n,progress:o,direction:d};i.state==="enter"&&e.stepProgress(a)}function C(t,o=!0){const n=S(t),i=r[n],a={element:t,index:n,direction:d};i.direction=d,i.state="enter",_[n]||e.stepEnter(a),A&&(_[n]=!0)}function F(t,o=!0){const n=S(t),i=r[n];if(!i.state)return!1;const a={element:t,index:n,direction:d};z&&(d==="down"&&i.progress<1?k(t,1):d==="up"&&i.progress>0&&k(t,0)),i.direction=d,i.state="exit",e.stepExit(a)}function D([t]){const o=S(t.target),n=r[o],i=t.target.offsetHeight;i!==n.height&&(n.height=i,L(n),I(n),B(n))}function U([t]){H(f);const{isIntersecting:o,target:n}=t;o?C(n):F(n)}function K([t]){const o=S(t.target),n=r[o],{isIntersecting:i,intersectionRatio:a,target:h}=t;i&&n.state==="enter"&&k(h,a)}function L({observers:t}){Object.keys(t).map(o=>{t[o].disconnect()})}function j(){r.forEach(L)}function B(t){const o=new ResizeObserver(D);o.observe(t.node),t.observers.resize=o}function G(){r.forEach(B)}function I(t){const o=window.innerHeight,n=t.offset||c,i=n.format==="pixels"?1:o,a=n.value*i,h=t.height/2-a,v=t.height/2-(o-a),m={rootMargin:`${h}px 0px ${v}px 0px`,threshold:.5,root:u},N=new IntersectionObserver(U,m);N.observe(t.node),t.observers.step=N,R&&Z({id:s,step:t,marginTop:h})}function J(){r.forEach(I)}function Q(t){const o=window.innerHeight,n=t.offset||c,i=n.format==="pixels"?1:o,a=n.value*i,h=-a+t.height,v=a-o,x=`${h}px 0px ${v}px 0px`,w=te(t.height,p),g={rootMargin:x,threshold:w},m=new IntersectionObserver(K,g);m.observe(t.node),t.observers.progress=m}function V(){r.forEach(Q)}function T(){j(),G(),J(),z&&V()}const l={};return l.setup=({step:t,parent:o,offset:n=.5,threshold:i=4,progress:a=!1,once:h=!1,debug:v=!1,container:x=void 0,root:w=null})=>(ne(x),r=W(t,o).map((g,m)=>({index:m,direction:void 0,height:g.offsetHeight,node:g,observers:{},offset:M(g.dataset.offset),top:re(g),progress:0,state:void 0})),r.length?(z=a,A=h,R=v,p=Math.max(1,+i),c=M(n),f=x,u=w,q(),se(r),E(!0),l):($("no step elements"),l)),l.enable=()=>(E(!0),l),l.disable=()=>(E(!1),l),l.destroy=()=>(E(!1),q(),l),l.resize=()=>(T(),l),l.offset=t=>t==null?c.value:(c=M(t),T(),l),l.onStepEnter=t=>(typeof t=="function"?e.stepEnter=t:$("onStepEnter requires a function"),l),l.onStepExit=t=>(typeof t=="function"?e.stepExit=t:$("onStepExit requires a function"),l),l.onStepProgress=t=>(typeof t=="function"?e.stepProgress=t:$("onStepProgress requires a function"),l),l}const oe=(e,s)=>{const r=e.__vccOpts||e;for(const[c,f]of s)r[c]=f;return r},ie={name:"Scrollama",inheritAttrs:!1,emits:["step-progress","step-enter","step-exit"],data(){return{scroller:null}},computed:{opts(){const e=this.$&&this.$.vnode&&this.$.vnode.props?this.$.vnode.props:{},s=Object.prototype.hasOwnProperty.call(e,"onStepProgress");return Object.assign({},{step:Array.from(this.$el.children),progress:s},this.$attrs)}},mounted(){this.scroller=Y(),this.setup()},beforeUnmount(){this.scroller&&this.scroller.destroy(),window.removeEventListener("resize",this.handleResize)},methods:{setup(){this.scroller&&(this.scroller.destroy(),this.scroller.setup(this.opts).onStepProgress(e=>{this.$emit("step-progress",e)}).onStepEnter(e=>{this.$emit("step-enter",e)}).onStepExit(e=>{this.$emit("step-exit",e)}),window.removeEventListener("resize",this.handleResize),window.addEventListener("resize",this.handleResize))},handleResize(){this.scroller&&this.scroller.resize()}}},ce={class:"scrollama__steps"};function le(e,s,r,c,f,u){return y.openBlock(),y.createElementBlock("div",ce,[y.renderSlot(e.$slots,"default")])}const ae=oe(ie,[["render",le]]);function fe(e){let s=null,r=null;y.onMounted(()=>{s=Y();const c={},f=["onStepEnter","onStepExit","onStepProgress"];for(const[u,p]of Object.entries(e))f.includes(u)||(c[u]=p);s.setup(c),e.onStepEnter&&s.onStepEnter(e.onStepEnter),e.onStepExit&&s.onStepExit(e.onStepExit),e.onStepProgress&&s.onStepProgress(e.onStepProgress),r=()=>{s&&s.resize()},window.addEventListener("resize",r)}),y.onBeforeUnmount(()=>{s&&(s.destroy(),s=null),r&&(window.removeEventListener("resize",r),r=null)})}exports.default=ae;exports.useScrollama=fe;
